{% extends "base.html" %}
{% block content %}
<h1>{% if label %}Edit Label{% else %}New Label{% endif %}</h1>
<form method="post" action="{% if label %}/ui/labels/{{ label.id }}/edit{% else %}/ui/labels/create{% endif %}">
    <div class="mb-3">
        <label for="name" class="form-label">Name</label>
        <input type="text" class="form-control" id="name" name="name" value="{{ label.name if label else '' }}" required>
    </div>
    <div class="mb-2">
        <label class="form-label">Selected Image Types</label>
        <div id="selected-image-type-badges"></div>
    </div>
    <div class="mb-3">
        <label class="form-label">Image Types</label>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-2">
        {% for t in image_types %}
          <div class="col">
            <div class="form-check">
                <input class="form-check-input image-type-checkbox" type="checkbox" name="image_type_ids" id="imgtype{{ t.id }}" value="{{ t.id }}" data-name="{{ t.name }}" {% if label and t in label.image_types %}checked{% endif %}>
                <label class="form-check-label" for="imgtype{{ t.id }}">{{ t.name }}</label>
            </div>
          </div>
        {% endfor %}
        </div>
    </div>
    <button type="submit" class="btn btn-primary">Save</button>
</form>
<script>
  function renderSelectedBadges() {
    const container = document.getElementById('selected-image-type-badges');
    const checked = Array.from(document.querySelectorAll('.image-type-checkbox:checked'));
    container.innerHTML = '';
    if (checked.length === 0) {
      container.innerHTML = '<span class="text-muted">None</span>';
      return;
    }
    checked.forEach(cb => {
      const badge = document.createElement('span');
      badge.className = 'badge bg-secondary me-1 mb-1';
      badge.textContent = cb.getAttribute('data-name');
      container.appendChild(badge);
    });
  }
  document.addEventListener('change', (e) => {
    if (e.target && e.target.classList.contains('image-type-checkbox')) {
      renderSelectedBadges();
    }
  });
  document.addEventListener('DOMContentLoaded', renderSelectedBadges);
</script>
{% endblock %}
